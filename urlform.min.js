"use strict";const QueryLocationQuery="query",QueryLocationFragment="fragment",DefaultFormOptions={FormParameters:[],prefix:"",shareURLBtn:"#shareURLBtn",shareURL:"#shareURL",shareURLArea:"#shareURLArea",defaultQueryLocation:QueryLocationFragment,callback:null,cleanURL:!1,localStorageNamespace:"URLFormJS_",Sanitized:!1,Inited:!1,ShareURLBtnElement:HTMLButtonElement,ClearBtnElement:HTMLButtonElement,formID:"",FormMode:!1,FormElement:HTMLFormElement};function Init(e){console.log("Initializing URLFormJS: ",e);let r={};return r=sanitizeFormOptions(e),r.ShareURLBtnElement=document.querySelector(r.shareURLBtn),r.ShareURLBtnElement!=null&&r.ShareURLBtnElement.addEventListener("click",()=>ShareURI(r)),r.ClearBtnElement=document.querySelector(r.clearBtn),r.ClearBtnElement!=null&&r.ClearBtnElement.addEventListener("click",()=>{Clear(r)}),isEmpty(r.formID)||(r.FormElement=document.getElementById(r.formID),r.FormElement!==null&&(r.FormMode=!0)),window.addEventListener("hashchange",function(){window.location.reload()}),r.Inited=!0,r}function Populate(e){let r={};for(let a of e.FormParameters)a.saveSetting&&(r[a.name]=getSavedSetting(a.name,e));let t=GetQuagParts(e).pairs,l={...r,...t};PopulateFromValues(l,e)}function PopulateFromValues(e,r){if(!r.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");SetForm(e,r),ShareURI(r)}function SetForm(e,r){try{for(let t of r.FormParameters){let l=t.id,a=t.name,n="";isEmpty(l)&&(l=r.prefix+a),t.defaultValue!==void 0&&(n=t.defaultValue),e["-"+a]!==void 0&&t.type=="bool"&&(n=!1),a in e&&(n=e[a]),n===!0&&(n="true"),t.type==="bool"&&n===""&&e[a]!==void 0&&(n="true"),isEmpty(t.func)||t.func(),t.type=="bool"&&n==="true"&&(isEmpty(t.funcTrue)||t.funcTrue());let u=document.getElementById(l);u!=null&&(t.type=="bool"&&n=="true"&&(u.checked=!0),!isEmpty(n)&&t.type!=="bool"&&(u.value=n),t.saveSetting&&u.addEventListener("input",f=>{t.type=="bool"?setSavedSetting(a,f.target.checked,r):setSavedSetting(a,f.target.value,r)}))}}finally{isEmpty(r.callback)||r.callback()}}function getSavedSetting(e,r){return localStorage.getItem(r.localStorageNamespace+r.prefix+e)}function setSavedSetting(e,r,t){return localStorage.setItem(t.localStorageNamespace+t.prefix+e,r)}function sanitizeFormOptions(e){let r={...DefaultFormOptions};if(isEmpty(e))return r;if(!(!isEmpty(e.Sanitized)&&e.Sanitized===!0)){isEmpty(e.formID)||(r.formID=e.formID),isEmpty(e.prefix)||(r.prefix=e.prefix),isEmpty(e.clearBtn)||(r.clearBtn=e.clearBtn),isEmpty(e.shareURLArea)||(r.shareURLArea=e.shareURLArea),isEmpty(e.shareURL)||(r.shareURL=e.shareURL),isEmpty(e.shareURLBtn)||(r.shareURLBtn=e.shareURLBtn),isEmpty(e.defaultQueryLocation)||(r.defaultQueryLocation=e.defaultQueryLocation),isEmpty(e.callback)||(r.callback=e.callback),isEmpty(e.cleanURL)||(r.cleanURL=e.cleanURL),isEmpty(e.localStorageNamespace)||(r.localStorageNamespace=e.localStorageNamespace),e.defaultQueryLocation!==QueryLocationQuery&&(r.defaultQueryLocation=QueryLocationFragment);for(let t of e.FormParameters)t.queryLocation!==QueryLocationFragment&&t.queryLocation!==QueryLocationQuery&&(t.queryLocation=r.defaultQueryLocation),r.FormParameters.push(t);return r.Sanitized=!0,r}}async function ShareURI(e){let r=GetForm(e),t=GetQuagParts(e);var l=new URL(window.location.origin+window.location.pathname);for(let a of e.FormParameters){let n=encodeURIComponent(r[a.name]);if(n=="undefined"&&(n=""),a.type=="bool"&&(n===!1&&(n="false"),a.defaultValue===!0&&n==""&&(n="false")),a.nonFormValue&&t.pairs.hasOwnProperty(a.name))break;if(n==""){l.searchParams.delete(a.name),delete t.fragment.pairs[a.name];continue}if(a.queryLocation===QueryLocationFragment){l.searchParams.delete(a.name),t.fragment.pairs[a.name]=n;continue}l.searchParams.set(a.name,n),delete t.fragment.pairs[a.name]}if(!isEmpty(t.query.extras)&&!e.cleanURL)for(let a in t.query.extras)l.searchParams.set(a,t.query.extras[a]);return l.hash=quagPartsToURLHash(t.fragment,e),setShareURL(l.href,e),l}function setShareURL(e,r){let t=document.querySelector(r.shareURL);t!==null&&(t.innerHTML=e.link(e));let l=document.querySelector(r.shareURLArea);l!==null&&(l.innerHTML=e)}function quagPartsToURLHash(e,r){let t="#"+e.before;var l=Object.keys(e.pairs).length;if(l!=0){t+="?";for(let n in e.pairs){l--;let i="="+e.pairs[n],u=r.FormParameters.find(f=>f.name==n);e.pairs[n]==""&&u.type=="bool"&&(i=""),u.type==="bool"&&(e.pairs[n]==="false"&&(n="-"+n),i=""),t+=n+i,l>0&&(t+="&")}}let a=Object.keys(e.extras).length;if(Object.keys(e.pairs).length&&a>0&&(t+="&"),a>0&&!r.cleanURL)for(let n in e.extras)a--,t+=n+"="+encodeURIComponent(e.extras[n]),a>0&&(t+="&");return t+=e.after,t=="#"?"":t}function getPairs(e){if(isEmpty(e))return{};let r={},t=e.split("&");for(const l in t){let a=t[l].split("="),n=a[0],i=a[1];n.at(0)==="-"&&(n=removeNegativeFlag(n),i="false"),!isEmpty(n)&&(i==null&&(i=""),r[n]=decodeURIComponent(i))}return r}function GetQuagParts(e){function r(){let a={string:getFragmentString(),pairs:{},extras:{},before:"",query:"",after:""},n=a.string.split("?");if(n.length==0?a.query=n[0]:(a.before=n[0],a.query=n[1]),!isEmpty(a.query)){let i=a.query.split(":~:");i.length>1&&(a.query=i[0],a.after=":~:"+i[1])}return a.pairs=getPairs(a.query),JSON.parse(JSON.stringify(a))}let t={query:{string:decodeURIComponent(window.location.search.substring(1)),pairs:getPairs(window.location.search.substring(1)),extras:{}},fragment:r()};t.pairs={...t.query.pairs,...t.fragment.pairs};let l=[];for(let a of e.FormParameters)l.push(a.name);for(let a of Object.keys(t.query.pairs))a=removeNegativeFlag(a),l.includes(a)||(t.query.extras[a]=t.query.pairs[a],delete t.query.pairs[a]);for(let a of Object.keys(t.fragment.pairs))a=removeNegativeFlag(a),l.includes(a)||(t.fragment.extras[a]=t.fragment.pairs[a],delete t.fragment.pairs[a]);return t}function removeNegativeFlag(e){return e.at(0)==="-"?e.substring(1):e}function GetURLKeyValue(e){return isEmpty(e)&&(e=GetDefaultFormOptions()),GetQuagParts(e).pairs}function Serialize(e){return JSON.stringify(GetForm(e))}function GetForm(e,r){if(!e.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");let t={};if(!e.FormMode){for(let a of e.FormParameters){let n,i=a.name;isEmpty(a.id)||(i=a.id);let u=document.getElementById(e.prefix+i);if(u!==null)switch(a.type){default:n=u.value,isEmpty(n)&&(n="");break;case"bool":n=u.checked;break;case"number":n=Number(u.value),isEmpty(n)&&(n=0);break}isEmpty(n)?r&&(t[a.name]=n):t[a.name]=n}return t}let l=new FormData(e.FormElement);for(let[a,n]of l)(n=="true"||n=="on")&&(n=!0),(n=="false"||n=="unchecked")&&(n=!1),isEmpty(e.prefix)||(a=a.substring(e.prefix.length)),isEmpty(n)?r&&(t[a]=n):t[a]=n;return t}function GetFormElements(e){let r={};for(let t of e.FormParameters)r[t.name]=document.getElementById(e.prefix+t.name);return r}function getFragmentString(){let e=window.location.hash.split("#");return window.location.protocol!=="file:"&&!navigator.userAgent.includes("Firefox")&&(e=performance.getEntriesByType("navigation")[0].name.split("#")),e.length==1?"":decodeURIComponent(e[1])}function Clear(e){if(!e.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");if(e.FormMode){for(let t of FormOptions.FormElement.elements)t.type==="checkbox"?t.checked=!1:t.value="";return}for(let t of e.FormParameters){let l=e.prefix+t.name,a=t.id;if(isEmpty(a)&&(a=l),t.type=="bool"){let i=document.getElementById(a);i!=null&&(i.checked=!1);continue}let n=document.getElementById(a);n!=null&&(n.value="")}var r=new URL(window.location.origin+window.location.pathname);setShareURL(r.href,e)}function GetDefaultFormOptions(){return DefaultFormOptions}function SetURLNoReload(e){window.history.pushState({},"",e)}function IsEmpty(e){return isEmpty(GetForm(e))}function isEmpty(e){return typeof e=="function"?!1:Array.isArray(e)?isEmpty(e[0]):e===Object(e)?Object.keys(e).length===0:!isBool(e)}function isBool(e){return!(e===!1||e==="false"||e===void 0||e==="undefined"||e===""||e===0||e==="0"||e===null||e==="null"||e==="NaN"||Number.isNaN(e)||e===Object(e))}
//# sourceMappingURL=urlform.min.js.map
// UMD export see https://github.com/Cyphrme/UMD_tutorial
(function(global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
		typeof define === 'function' && define.amd ? define(['exports'], factory) :
		(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.URLForm = {}))
})(this, (function(exports) {
	exports.Init = Init
	exports.SetURLNoReload = SetURLNoReload
	exports.PopulateFromValues = PopulateFromValues
	exports.Populate = Populate
	exports.Serialize = Serialize
	exports.GetForm = GetForm
	exports.GetFormElements = GetFormElements
	exports.GetURLKeyValue = GetURLKeyValue
	exports.GetQuagParts = GetQuagParts
	exports.SetForm = SetForm
	exports.Clear = Clear
	exports.IsEmpty = IsEmpty
	exports.GetDefaultFormOptions = GetDefaultFormOptions
	exports.ShareURI = ShareURI
	Object.defineProperty(exports, '__esModule', {
		value: true
	})
}))