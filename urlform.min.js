"use strict";const QueryLocationQuery="query",QueryLocationFragment="fragment",DefaultFormOptions={FormParameters:[],prefix:"",shareURLBtn:"#shareURLBtn",shareURL:"#shareURL",shareURLArea:"#shareURLArea",defaultQueryLocation:QueryLocationFragment,callback:null,cleanURL:!1,localStorageNamespace:"URLFormJS_",Sanitized:!1,Inited:!1,ShareURLBtnElement:HTMLButtonElement,ClearBtnElement:HTMLButtonElement,formID:"",FormMode:!1,FormElement:HTMLFormElement};function Init(e){let t={};return t=sanitizeFormOptions(e),t.ShareURLBtnElement=document.querySelector(t.shareURLBtn),t.ShareURLBtnElement!=null&&t.ShareURLBtnElement.addEventListener("click",()=>ShareURI(t)),t.ClearBtnElement=document.querySelector(t.clearBtn),t.ClearBtnElement!=null&&t.ClearBtnElement.addEventListener("click",()=>{Clear(t)}),isEmpty(t.formID)||(t.FormElement=document.getElementById(t.formID),t.FormElement!==null&&(t.FormMode=!0)),t.Inited=!0,t}function Populate(e){let t={};for(let r of e.FormParameters)r.saveSetting&&(t[r.name]=getSavedSetting(r.name,e));let a=GetQuagParts(e).pairs,l={...t,...a};PopulateFromValues(l,e)}function PopulateFromValues(e,t){if(!t.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");SetForm(e,t),ShareURI(t)}function getFragmentString(){let e=window.location.hash.split("#");return window.location.protocol!=="file:"&&!navigator.userAgent.includes("Firefox")&&(e=performance.getEntriesByType("navigation")[0].name.split("#")),e.length==1?"":decodeURIComponent(e[1])}function SetForm(e,t){try{for(let a of t.FormParameters){let l=a.name,r=e[l],n=a.id;r===!0&&(r="true"),a.type=="bool"&&r===""&&(r="true"),isEmpty(n)&&(n=t.prefix+l),isEmpty(a.func)||a.func(),a.type=="bool"&&r=="true"&&(isEmpty(a.funcTrue)||a.funcTrue());let i=document.getElementById(n);i!=null&&(a.type=="bool"&&r=="true"&&(i.checked=!0),isEmpty(r)||(i.value=r),a.saveSetting&&i.addEventListener("input",u=>{a.type=="bool"?setSavedSetting(l,u.target.checked,t):setSavedSetting(l,u.target.value,t)}))}}finally{isEmpty(t.callback)||t.callback()}}function getSavedSetting(e,t){return localStorage.getItem(t.localStorageNamespace+t.prefix+e)}function setSavedSetting(e,t,a){return console.log("URLFormJS - Saving setting:",e,t),localStorage.setItem(a.localStorageNamespace+a.prefix+e,t)}function sanitizeFormOptions(e){let t={...DefaultFormOptions};if(isEmpty(e))return t;if(!(!isEmpty(e.Sanitized)&&e.Sanitized===!0)){isEmpty(e.formID)||(t.formID=e.formID),isEmpty(e.prefix)||(t.prefix=e.prefix),isEmpty(e.clearBtn)||(t.clearBtn=e.clearBtn),isEmpty(e.shareURLArea)||(t.shareURLArea=e.shareURLArea),isEmpty(e.shareURL)||(t.shareURL=e.shareURL),isEmpty(e.shareURLBtn)||(t.shareURLBtn=e.shareURLBtn),isEmpty(e.defaultQueryLocation)||(t.defaultQueryLocation=e.defaultQueryLocation),isEmpty(e.callback)||(t.callback=e.callback),isEmpty(e.cleanURL)||(t.cleanURL=e.cleanURL),isEmpty(e.localStorageNamespace)||(t.localStorageNamespace=e.localStorageNamespace),e.defaultQueryLocation!==QueryLocationQuery&&(t.defaultQueryLocation=QueryLocationFragment);for(let a of e.FormParameters)a.queryLocation!==QueryLocationFragment&&a.queryLocation!==QueryLocationQuery&&(a.queryLocation=t.defaultQueryLocation),t.FormParameters.push(a);return t.Sanitized=!0,t}}function ShareURI(e){let t=GetQuagParts(e),a=GetForm(e);var l=new URL(window.location.origin+window.location.pathname);for(let r of e.FormParameters){let n=a[r.name];if(isEmpty(n)){l.searchParams.delete(r.name),delete t.fragment.pairs[r.name];continue}if(r.queryLocation===QueryLocationFragment){l.searchParams.delete(r.name),t.fragment.pairs[r.name]=n;continue}l.searchParams.set(r.name,n),delete t.fragment.pairs[r.name]}if(!isEmpty(t.query.extras)&&!e.cleanURL)for(let r in t.query.extras)l.searchParams.set(r,t.query.extras[r]);return l.hash=quagPartsToURLHash(t.fragment,e),setShareURL(l.href,e),l}function setShareURL(e,t){let a=document.querySelector(t.shareURL);a!==null&&(a.innerHTML=e.link(e));let l=document.querySelector(t.shareURLArea);l!==null&&(l.innerHTML=e)}function quagPartsToURLHash(e,t){let a="#"+e.before;var l=Object.keys(e.pairs).length;if(l!=0){a+="?";for(let n in e.pairs)l--,a+=n+"="+e.pairs[n],l>0&&(a+="&")}let r=Object.keys(e.extras).length;if(Object.keys(e.pairs).length&&r>0&&(a+="&"),r>0&&!t.cleanURL)for(let n in e.extras)r--,a+=n+"="+e.extras[n],r>0&&(a+="&");return a+=e.after,encodeURIComponent(a)}function getPairs(e){if(isEmpty(e))return{};let t={},a=e.split("&");for(const l in a){console.debug(a[l]);let r=a[l].split("="),n=r[0],i=r[1];isEmpty(n)||(i==null&&(i=""),t[n]=decodeURIComponent(i))}return t}function GetQuagParts(e){function t(){let r={string:getFragmentString(),pairs:{},extras:{},before:"",query:"",after:""},n=r.string.split("?");if(n.length==0?r.query=n[0]:(r.before=n[0],r.query=n[1]),!isEmpty(r.query)){let i=r.query.split(":~:");i.length>1&&(r.query=i[0],r.after=":~:"+i[1])}return r.pairs=getPairs(r.query),JSON.parse(JSON.stringify(r))}let a={query:{string:decodeURIComponent(window.location.search.substring(1)),pairs:getPairs(window.location.search.substring(1)),extras:{}},fragment:t()};a.pairs={...a.query.pairs,...a.fragment.pairs};let l=[];for(let r of e.FormParameters)l.push(r.name);for(let r of Object.keys(a.query.pairs))l.includes(r)||(a.query.extras[r]=a.query.pairs[r],delete a.query.pairs[r]);for(let r of Object.keys(a.fragment.pairs))l.includes(r)||(a.fragment.extras[r]=a.fragment.pairs[r],delete a.fragment.pairs[r]);return a}function GetURLKeyValue(e){return GetQuagParts(e).pairs}function Serialize(e){return JSON.stringify(GetForm(e))}function GetForm(e,t){if(!e.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");let a={};if(!e.FormMode){for(let r of e.FormParameters){let n,i=r.name;isEmpty(r.id)||(i=r.id);let u=document.getElementById(e.prefix+i);if(u!==null)switch(r.type){default:n=u.value,isEmpty(n)&&(n="");break;case"bool":n=u.checked;break;case"number":n=Number(u.value),isEmpty(n)&&(n=0);break}isEmpty(n)?t&&(a[r.name]=n):a[r.name]=n}return a}let l=new FormData(e.FormElement);for(let[r,n]of l)(n=="true"||n=="on")&&(n=!0),(n=="false"||n=="unchecked")&&(n=!1),isEmpty(e.prefix)||(r=r.substring(e.prefix.length)),isEmpty(n)?t&&(a[r]=n):a[r]=n;return a}function GetFormElements(e){let t={};for(let a of e.FormParameters)t[a.name]=document.getElementById(e.prefix+a.name);return t}function Clear(e){if(!e.Inited)throw new Error("URLFormJS: Init() must be called first to initialize the URLFormJS module.");if(e.FormMode){for(let a of FormOptions.FormElement.elements)a.type==="checkbox"?a.checked=!1:a.value="";return}for(let a of e.FormParameters){let l=e.prefix+a.name,r=a.id;if(isEmpty(r)&&(r=l),a.type=="bool"){let i=document.getElementById(r);i!=null&&(i.checked=!1);continue}let n=document.getElementById(r);n!=null&&(n.value="")}var t=new URL(window.location.origin+window.location.pathname);setShareURL(t.href,e)}function IsEmpty(e){return isEmpty(GetForm(e))}function GetDefaultFormOptions(){return DefaultFormOptions}function isEmpty(e){return typeof e=="function"?!1:Array.isArray(e)?isEmpty(e[0]):e===Object(e)?Object.keys(e).length===0:!isBool(e)}function isBool(e){return!(e===!1||e==="false"||e===void 0||e==="undefined"||e===""||e===0||e==="0"||e===null||e==="null"||e==="NaN"||Number.isNaN(e)||e===Object(e))}
//# sourceMappingURL=urlform.min.js.map
// UMD export see https://github.com/Cyphrme/UMD_tutorial
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
		typeof define === 'function' && define.amd ? define(['exports'], factory) :
		(global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.URLForm = {}));
})(this, (function (exports) {
	exports.Init = Init;
	exports.PopulateFromValues = PopulateFromValues;
	exports.Populate = Populate;
	exports.Serialize = Serialize;
	exports.GetForm = GetForm;
	exports.GetFormElements = GetFormElements;
	exports.GetURLKeyValue = GetURLKeyValue;
	exports.GetQuagParts = GetQuagParts;
	exports.SetForm = SetForm;
	exports.Clear = Clear;
	exports.IsEmpty = IsEmpty;
	exports.GetDefaultFormOptions = GetDefaultFormOptions;
	exports.ShareURI = ShareURI;
	Object.defineProperty(exports, '__esModule', {
		value: true
	});
}));